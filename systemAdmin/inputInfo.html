<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Xenon Boostrap Admin Panel" />
    <meta name="author" content="" />

    <title>手播课运营平台</title>
    <link rel="Shortcut icon" href="../assets/images/icon-shouboke16.ico">
    <!--<link rel="stylesheet" href="http://fonts.useso.com/css?family=Arimo:400,700,400italic">-->
    <link rel="stylesheet" href="../assets/css/fonts/linecons/css/linecons.css">
    <link rel="stylesheet" href="../assets/css/fonts/fontawesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="../assets/css/bootstrap.css">
    <link rel="stylesheet" href="../assets/css/xenon-core.css">
    <link rel="stylesheet" href="../assets/css/xenon-forms.css">
    <link rel="stylesheet" href="../assets/css/xenon-components.css">
    <link rel="stylesheet" href="../assets/css/xenon-skins.css">
    <link rel="stylesheet" href="../assets/css/custom.css">
    <link rel="stylesheet" href="../assets/css/index.css">
    <link rel="stylesheet" href="https://cdn.staticfile.org/webuploader/0.1.5/webuploader.css"/>
    <script src="../assets/js/jquery-1.11.1.min.js"></script>
    <script src="../assets/js/jquery.extend.js"></script>
    <script src="../assets/js/common.js"></script>
    <script src="../assets/js/validSystem.js"></script>
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style>
        .detail a{
            color: #ffffff;
        }
        .form-group>label{
            width: 15%;
            float: left;
            line-height: 32px;
        }
        .form-group:nth-of-type(4)>label,.form-group:nth-of-type(5)>label,.form-group:nth-of-type(7)>label{
            width: auto;
            margin-right: 20px;
        }
        #uploader,#uploader_2{
            float: left;
            min-width: 300px;
        }
        .form-group>input{
            width: 80%;
            float: left;
        }
        .form-group{
            clear: left;
        }
        .btns{
            height: 38px;
            position: relative;
            clear: left;
        }
        #ctlBtn,#begin{
            height: 38px;
            border-radius: 3px;
            position: absolute;
            margin-left: 15px;
            top: 0;
        }
        #filePicker,#itemPicker{
            display: inline-block;
        }
        #fileList div,#itemList div{
            float: left;
            margin-left: 10px;
        }
        .btn{
            border-radius: 3px;
        }
        .choose{
            background-color: #99ed70;
            color: #ffffff;
        }
        #category div{
            border: none;
        }
        #category button{
            border:none;
        }
        #category div.btn:hover{
            background-color: #99ED6C;
            color: #ffffff;
        }
        #labels{
            display: inline-block;
        }
        #introduce>textarea{
            resize: none;
            border: none;
            text-align: left;
        }
    </style>
</head>
<body class="page-body">

<div class="settings-pane">

    <a href="#" data-toggle="settings-pane" data-animate="true">
        &times;
    </a>

    <div class="settings-pane-inner">

        <div class="row">

            <div class="col-md-4">

                <div class="user-info">

                    <div class="user-image">
                        <a href="extra-profile.html">
                            <img src="../assets/images/user-2.png" class="img-responsive img-circle" />
                        </a>
                    </div>

                    <div class="user-details">

                        <h3>
                            <a href="extra-profile.html">John Smith</a>

                            <!-- Available statuses: is-online, is-idle, is-busy and is-offline -->
                            <span class="user-status is-online"></span>
                        </h3>

                        <p class="user-title">Web Developer</p>

                        <div class="user-links">
                            <a href="extra-profile.html" class="btn btn-primary">Edit Profile</a>
                            <a href="extra-profile.html" class="btn btn-success">Upgrade</a>
                        </div>

                    </div>

                </div>

            </div>

            <div class="col-md-8 link-blocks-env">

                <div class="links-block left-sep">
                    <h4>
                        <span>Notifications</span>
                    </h4>

                    <ul class="list-unstyled">
                        <li>
                            <input type="checkbox" class="cbr cbr-primary" checked="checked" id="sp-chk1" />
                            <label for="sp-chk1">Messages</label>
                        </li>
                        <li>
                            <input type="checkbox" class="cbr cbr-primary" checked="checked" id="sp-chk2" />
                            <label for="sp-chk2">Events</label>
                        </li>
                        <li>
                            <input type="checkbox" class="cbr cbr-primary" checked="checked" id="sp-chk3" />
                            <label for="sp-chk3">Updates</label>
                        </li>
                        <li>
                            <input type="checkbox" class="cbr cbr-primary" checked="checked" id="sp-chk4" />
                            <label for="sp-chk4">Server Uptime</label>
                        </li>
                    </ul>
                </div>

                <div class="links-block left-sep">
                    <h4>
                        <a href="#">
                            <span>Help Desk</span>
                        </a>
                    </h4>

                    <ul class="list-unstyled">
                        <li>
                            <a href="#">
                                <i class="fa-angle-right"></i>
                                Support Center
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                <i class="fa-angle-right"></i>
                                Submit a Ticket
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                <i class="fa-angle-right"></i>
                                Domains Protocol
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                <i class="fa-angle-right"></i>
                                Terms of Service
                            </a>
                        </li>
                    </ul>
                </div>

            </div>

        </div>

    </div>

</div>

<div class="page-container"><!-- add class "sidebar-collapsed" to close sidebar by default, "chat-visible" to make chat appear always -->

    <!-- Add "fixed" class to make the sidebar fixed always to the browser viewport. -->
    <!-- Adding class "toggle-others" will keep only one menu item open at a time. -->
    <!-- Adding class "collapsed" collapse sidebar root elements and show only icons. -->
    <div class="sidebar-menu toggle-others fixed">

        <div class="sidebar-menu-inner">

            <header class="logo-env">

                <!-- logo -->
                <div class="logo">
                    <a href="javascript:void(0)" class="logo-expanded">
                        <img src="../assets/images/icon220x60.png" width="160" alt="" />
                    </a>

                    <a  href="javascript:void(0)" class="logo-collapsed">
                        <img src="../assets/images/icon60.png" width="40" alt="" />
                    </a>
                </div>

                <!-- This will toggle the mobile menu and will be visible only on mobile devices -->
                <div class="mobile-menu-toggle visible-xs">
                    <!--<a href="#" data-toggle="user-info-menu">-->
                    <!--<i class="fa-bell-o"></i>-->
                    <!--<span class="badge badge-success">7</span>-->
                    <!--</a>-->

                    <a href="#" data-toggle="mobile-menu">
                        <i class="fa-bars"></i>
                    </a>
                </div>

                <!-- This will open the popup with user profile settings, you can use for any purpose, just be creative -->
                <!--<div class="settings-icon">-->
                <!--<a href="#" data-toggle="settings-pane" data-animate="true">-->
                <!--<i class="linecons-cog"></i>-->
                <!--</a>-->
                <!--</div>-->
            </header>

            <ul id="main-menu" class="main-menu">
                <!-- add class "multiple-expanded" to allow multiple submenus to open -->
                <!-- class "auto-inherit-active-class" will automatically add "active" class for parent elements who are marked already with class "active" -->
            </ul>
        </div>

    </div>

    <div class="main-content">

        <!-- User Info, Notifications and Menu Bar -->
        <nav class="navbar user-info-navbar" role="navigation">
            <!-- Right links for user info navbar -->
            <ul class="user-info-menu right-links list-inline list-unstyled">
                <li class="dropdown user-profile">
                    <a href="#" data-toggle="dropdown">
                        <img src="../assets/images/user-4.png" alt="user-image" class="img-circle img-inline userpic-32" width="28" />
							<span>
								<span id="username"></span>
								<i class="fa-angle-down"></i>
							</span>
                    </a>
                    <ul class="dropdown-menu user-profile-menu list-unstyled" style="width:126px">
                        <li>
                            <a href="../editpwd.html" id="editpwd">
                                <i class="fa-eyedropper"></i>
                                修改密码
                            </a>
                        </li>
                        <li class="last">
                            <a href="../login.html" id="logout">
                                <i class="fa-lock"></i>
                                退出登录
                            </a>
                        </li>
                    </ul>
                </li>
                <script>
                    $(function(){
                        $("#username").html($.fn.getSession('username'));
                        $("#logout").click(function(){//退出登录保留记住的用户,密码,token过期
                            $.fn.setSession('token',null);
                        })
                    })
                </script>
            </ul>
        </nav>
        <div class="row">
            <div class="form-group col-sm-4">
                <label>真实姓名</label>
                <input id="realName" type="text" class="form-control" placeholder="请输入姓名">
            </div>
            <div class="form-group col-sm-4">
                <label>手机号码</label>
                <input id="phone" type="text" class="form-control" placeholder="请输入手机号">
            </div>
            <div class="form-group col-sm-4">
                <label>身份证号</label>
                <input id="idNumber" type="text" class="form-control" placeholder="请输入身份证号">
            </div>
            <div class="form-group col-sm-12">
                <label>证件照</label>
                <div id="uploader">
                    <!--用来存放item-->
                    <div id="fileList" class="uploader-list"></div>
                    <div class="btns">
                        <div id="filePicker">选择文件</div>
                        <button id="ctlBtn" class="btn btn-default">开始上传</button>
                    </div>
                </div>
            </div>
            <div class="form-group col-sm-12">
                <label>专业领域</label>
                <div id="category">
                    <div id="labels">

                    </div>
                    <button class="btn btn-default " data-toggle="modal" data-target="#newCategory">＋</button>
                </div>
            </div>
            <div class="form-group col-sm-6">
                <label>个人介绍</label>
                <div id="introduce">
                    <textarea id="" cols="50" rows="10"></textarea>
                </div>
            </div>
            <div class="form-group col-sm-12">
                <label>资质证书（可选）</label>
                <div id="uploader_2">
                    <!--用来存放item-->
                    <div id="itemList" class="uploader-list"></div>
                    <div class="btns">
                        <div id="itemPicker">选择文件</div>
                        <button id="begin" class="btn btn-default">开始上传</button>
                    </div>
                </div>
            </div>
            <div class="form-group col-sm-12">
                <button id="submit" style="margin-left: 30%" class="btn btn-default">提交</button>
            </div>
        </div>
        <!-- Main Footer -->
        <footer class="main-footer footer-type-1">

            <div class="footer-inner">

                <!-- Add your copyright text here -->
                <div class="footer-text">
                    &copy; 2016
                    <strong>LYCAM+</strong>
                </div>


                <!-- Go to Top Link, just add rel="go-top" to any link to add this functionality -->
                <div class="go-up">

                    <a href="#" rel="go-top">
                        <i class="fa-angle-up"></i>
                    </a>

                </div>

            </div>

        </footer>
        <!--提现记录-->
    </div>

    <div class="page-loading-overlay">
        <div class="loader-2"></div>
    </div>
</div>

<!--添加分类-->
<div class="modal fade" id="newCategory">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title">添加分类</h4>
            </div>
            <div class="modal-body">
                <div class="panel-body">
                    <div class="form-group">
                        <input maxlength="4" type="text" class="form-control" name="title" placeholder="请输入分类名称">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" id="addCategory" data-dismiss="modal" class="audit btn btn-primary">确认</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<!-- Imported styles on this page -->
<link rel="stylesheet" href="../assets/css/fonts/meteocons/css/meteocons.css">

<!-- Bottom Scripts -->
<script src="../assets/js/bootstrap.min.js"></script>
<script src="../assets/js/TweenMax.min.js"></script>
<script src="../assets/js/resizeable.js"></script>
<script src="../assets/js/joinable.js"></script>
<script src="../assets/js/xenon-api.js"></script>
<script src="../assets/js/xenon-toggles.js"></script>


<!--绘制表格-->
<script src="../assets/js/datatables/js/jquery.dataTables.min.js"></script>
<script src="../assets/js/datatables/dataTables.bootstrap.js"></script>
<script src="../assets/js/datatables/yadcf/jquery.dataTables.yadcf.js"></script>
<script src="../assets/js/datatables/tabletools/dataTables.tableTools.min.js"></script>


<!-- Imported styles on this page -->
<!--<link rel="stylesheet" href="../assets/js/daterangepicker/daterangepicker-bs3.css">-->
<link rel="stylesheet" href="../assets/js/select2/select2.css">
<link rel="stylesheet" href="../assets/js/select2/select2-bootstrap.css">
<link rel="stylesheet" href="../assets/js/multiselect/css/multi-select.css">

<script src="../assets/js/select2/select2.min.js"></script>
<script src="../assets/js/multiselect/js/jquery.multi-select.js"></script>
<script src="../assets/js/toastr/toastr.min.js"></script>

<!--打印功能-->
<script src="../assets/js/jquery-migrate-1.2.1.min.js"></script>
<script src="../assets/js/jquery.jqprint-0.3.js"></script>

<!-- JavaScripts initializations and stuff -->
<script src="../assets/js/xenon-custom.js"></script>
<script src="../assets/js/menu.js"></script>
<script src="../assets/js/jquery.table2excel.js"></script>
<script src="https://cdn.staticfile.org/webuploader/0.1.5/webuploader.min.js"></script>
<script type="text/javascript">
    buildMenu(18);//统一通过menu.js创建菜单
    // 初始化Web Uploader
    getCategory();
    var idPhotoUrl=[];
    var credentUrl=[];
    var state='pending';
    var btns1={//上传身份证明
        pick: '#filePicker',
        list: '#fileList',
        upload: '#ctlBtn',
        type: 'IDPhotos'
    }
    var btns2= {//上传资质证书
        pick: '#itemPicker',
        list: '#itemList',
        upload: '#begin',
        type: 'credentials'
    }
    uploadImg(btns1);
    uploadImg(btns2);
    function uploadImg(btns){//上传图片相关配置
        var uploader = WebUploader.create({
            // swf文件路径
            swf: 'https://cdn.staticfile.org/webuploader/0.1.5/Uploader.swf',

            // 文件接收服务端。
            server: ' http://54.222.173.115:2000/attachment/uploadImg',

            // 选择文件的按钮。可选。
            // 内部根据当前运行是创建，可能是input元素，也可能是flash.
            pick: btns.pick,
            fileVal: 'pic',
            // 只允许选择图片文件。
            accept: {
                title: 'Images',
                extensions: 'gif,jpg,jpeg,bmp,png',
                mimeTypes: 'image/*'
            }
        });
        // 当有文件添加进来的时候
        uploader.on( 'fileQueued', function( file ) {
            var $li = $(
                            '<div id="' + file.id + '" class="file-item thumbnail">' +
                            '<img>'
                    ),
                    $img = $li.find('img');


            // $list为容器jQuery实例
            $(btns.list).append( $li );

            // 创建缩略图
            // 如果为非图片文件，可以不用调用此方法。
            // thumbnailWidth x thumbnailHeight 为 100 x 100
            uploader.makeThumb( file, function( error, src ) {
                if ( error ) {
                    $img.replaceWith('<span>不能预览</span>');
                    return;
                }

                $img.attr( 'src', src );
            }, 200 );
        });
        // 文件上传过程中创建进度条实时显示。
        uploader.on( 'uploadProgress', function( file, percentage ) {
            var $li = $( '#'+file.id ),
                    $percent = $li.find('.progress span');

            // 避免重复创建
            if ( !$percent.length ) {
                $percent = $('<p class="progress"><span></span></p>')
                        .appendTo( $li )
                        .find('span');
            }

            $percent.css( 'width', percentage * 100 + '%' );
        });

        // 文件上传成功，给item添加成功class, 用样式标记上传成功。
        uploader.on( 'uploadSuccess', function( file,res ) {
            $( '#'+file.id ).addClass('upload-state-done');
            if(btns.type=='IDPhotos'){
                idPhotoUrl.push(res.url);
            }else{
                credentUrl.push(res.url);
            }
        });

        // 文件上传失败，显示上传出错。
        uploader.on( 'uploadError', function( file ) {
            var $li = $( '#'+file.id ),
                    $error = $li.find('div.error');

            // 避免重复创建
            if ( !$error.length ) {
                $error = $('<div class="error"></div>').appendTo( $li );
            }

            $error.text('上传失败');
        });

        // 完成上传完了，成功或者失败，先删除进度条。
        uploader.on( 'uploadComplete', function( file ) {
            $( '#'+file.id ).find('.progress').remove();
        });

        uploader.on( 'all', function( type ) {
            if ( type === 'startUpload' ) {
                state = 'uploading';
            } else if ( type === 'stopUpload' ) {
                state = 'paused';
            } else if ( type === 'uploadFinished' ) {
                state = 'done';
            }

            if ( state === 'uploading' ) {
                $('#ctlBtn').text('暂停上传');
            } else {
                $('#ctlBtn').text('开始上传');
            }
        });

        $(btns.upload).on( 'click', function() {
            if ( state === 'uploading' ) {
                uploader.stop();
            } else {
                uploader.upload();
            }
        });
    }

    function getCategory(){//获取分类
        $.ajax({
            type: 'get',
            headers: {
                access_token: $.fn.getSession('token')
            },
            url: $.severHttp + '/v4/categories',
            success: function (data) {
                var html='';
                for(var i=0;i<data.items.length;i++){
                    html+='<div class="btn btn-default">'+data.items[i].name+'</div>';
                }
                $('#labels').html(html);
            },
            error: function (error) {

            }
        })
    }
    $('#labels').on('click','.btn',function(e){
        if($(e.target).hasClass('choose')){
            $(e.target).removeClass('choose');
        }else{
            if($('.choose').length<3){
                $(e.target).addClass('choose');
            }else{
                toastr.error("最多选择三个标签");
            }
        }
    })
    $('#newCategory').on('click','#addCategory',function(){
        var category=$('#newCategory input').val();
        if(category){
            $('#newCategory').modal('hide')
            $('#labels')[0].innerHTML+='<div class="btn btn-default">'+category+'</div>';
        }else{
            toastr.error("请输入分类名称");
        }
    })
    $('#submit').click(function(){
        var realName=$('#realName').val();
        var phone=$('#phone').val();
        var idNumber=$('#idNumber').val();
        var introduce=$('#introduce textarea').val();
        var pro=[];
        $('#labels .choose').each(function(){
            pro.push($(this).text());
        })
        var postData={};
        postData.realName=realName;
        postData.phone=phone;
        postData.identificate={};
        postData.identificate.type='individual';
        postData.identificate.tags=pro;
        postData.identificate.introduce=introduce;
        postData.identificate.ID=idNumber;
        postData.identificate.IDPhotos=idPhotoUrl;
        if(credentUrl.length>0){
            postData.identificate.credentials=credentUrl;
        }
        if(realName&&phone&&idNumber&&introduce&&pro.length>0&&idPhotoUrl.length>0){
            $.ajax({
                type: 'post',
                headers: {
                    access_token: $.fn.getSession('token')
                },
                data:postData,
                url: $.severHttp + '/user/individual/identificate?sourceType=handClassConsole&userId='+getUrlRequest()["id"],
                success: function (data) {
                    toastr.success("录入成功");
                    setTimeout(function(){
                        location.href='./personManage.html';
                    },500)
                },
                error: function (error) {
                    toastr.error(error.responseJSON.error);
                }
            })
        }else{
            toastr.error("信息不完整");
        }
    })
    function getUrlRequest(){
        var url = location.search; //获取url中"?"符后的字串
        var theRequest = new Object();
        if (url.indexOf("?") != -1) {
            var str = url.split('?')[1];
            if (str.indexOf("&") != -1) {
                var strs = str.split("&");
                for (var i = 0; i < strs.length; i++) {
                    theRequest[strs[i].split("=")[0]] = decodeURI(strs[i].split("=")[1]);
                }
            } else {
                var key = str.split("=")[0]
                var value = str.split("=")[1]
                theRequest[key] = decodeURI(value);
            }
        }
        return theRequest;
    }
</script>
</body>
</html>